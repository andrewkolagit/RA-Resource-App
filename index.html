<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RA Help App</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</head>
<body>
    <div class="notification-container">
        <span class="notification-bell" id="notificationBell">
            ðŸ””
            <span class="notification-dot" id="notificationDot"></span> <!-- New Notification Dot -->
        </span>
        <div class="notification-dropdown" id="notificationDropdown">
            <h3>Notifications</h3>
            <ul id="notificationList">
                <li>No new notifications</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h1>RA HELP APP</h1>
        <div class="option-list">
            <a href="information.html" class="option color-1">
                <div class="option-content">
                    <h2>ESSENTIAL INFORMATION</h2>
                </div>
            </a>
            <a href="forms.html" class="option color-2">
                <div class="option-content">
                    <h2>FORMS</h2>
                </div>
            </a>
            <a href="https://app.smartsheet.com/b/form/e7f6798063c14cf9a19502f425f4ea09" class="option color-4">
                <div class="option-content">
                    <h2>LOCKOUT FORM</h2>
                </div>
            </a>
            <a href="https://app.smartsheet.com/b/form/3be370ba12b14142ba819f8119e0ead8?confirm=true" class="option color-3">
                <div class="option-content">
                    <h2>DUTY REPORT</h2>
                </div>
            </a>
            <a href="https://cm.maxient.com/reportingform.php?AUMontgomery&layout_id=4" class="option color-5">
                <div class="option-content">
                    <h2>INCIDENT REPORT</h2>
                </div>
            </a>
            <a href="Weekly Housing Roster for Staff 2024-10-14 08-00-31.csv" class="option color-6" target="_blank">
                <div class="option-content">
                    <h2>DOWNLOAD LATEST STARREZ</h2>
                </div>
            </a>
            <a href="https://aumontgomery-my.sharepoint.com/:x:/g/personal/msmith59_aum_edu/ES5lWxo8CcxBsgu4NelB3JMBv0XhkhI0cjNtxWzj4rHt4Q?e=ZBx4b3" class="option color-1">
                <div class="option-content">
                    <h2>NO ACCESS LIST</h2>
                </div>
            </a>
            <a href="Fall 2024 Duty Calendar.pdf" class="option color-2" target="_blank">
                <div class="option-content">
                    <h2>DUTY SCHEDULE</h2>
                </div>
            </a>
        </div>
    </div>

    <div class="spacer"></div>

    <div class="container emergency-container">
        <h1>Emergency Contacts</h1>
        <p>If there is an emergency, please contact the following:</p>
        <h3><a href="tel:+13343183170" style="color: #A8E600;">CY/WH Duty Phone: +13343183170</a></h3>
        <h3><a href="tel:+13343183171" style="color: #A8E600;">NC/P-40 Duty Phone: +13343183171</a></h3>
        <h3><a href="tel:+13342443424" style="color: #A8E600;">Campus Police: +13342443424</a></h3>
        <br>
        <h1>RLCs</h1>
        <h3><a href="tel:+13343203385" style="color: #A8E600;">Ram: +13343203385</a></h3>
        <h3><a href="tel:+1332355208" style="color: #A8E600;">Amberly: +1332355208</a></h3>
        <h3><a href="tel:+1332243791" style="color: #A8E600;">Lauryn: +1332243791</a></h3>
        <h3><a href="tel:+13343003269" style="color: #A8E600;">Taylor: +13343003269</a></h3>
    </div>

    <script>
        const notificationBell = document.getElementById('notificationBell');
        const notificationDropdown = document.getElementById('notificationDropdown');
        const notificationList = document.getElementById('notificationList');
        const notificationDot = document.getElementById('notificationDot'); // Get the notification dot element

        notificationBell.addEventListener('click', () => {
            notificationDropdown.classList.toggle('show');
            loadNotifications(); // Load notifications when bell is clicked
            notificationDot.style.display = 'none'; // Hide dot when dropdown is opened
        });

        window.addEventListener('click', (event) => {
            if (!event.target.matches('.notification-bell')) {
                if (notificationDropdown.classList.contains('show')) {
                    notificationDropdown.classList.remove('show');
                }
            }
        });

        async function fetchNotifications() {
            const apiKey = 'patHsrrNu8CMXvlpA.debf08c28e5905ff5a415cdacb999abd2695b1559cb5f9feb22c84fb1310e428'; // Replace with your Airtable Personal Access Token
            const baseId = 'appoXg3vvpfVAXmqH'; // Replace with your Airtable Base ID
            const tableName = 'notifications'; // Name of your table
            const url = https://api.airtable.com/v0/${baseId}/${tableName};

            const response = await fetch(url, {
                headers: {
                    Authorization: Bearer ${apiKey}
                }
            });

            if (!response.ok) {
                console.error('Error fetching data:', response.statusText);
                return [];
            }

            const data = await response.json();
            return data.records;
        }

        function filterNotifications(records) {
            const currentTime = new Date();
            const notificationsToShow = records.filter(record => {
                const dateToPost = new Date(record.fields.date_to_post);
                const dateToRemove = new Date(record.fields.date_to_remove);
                return (currentTime >= dateToPost && currentTime < dateToRemove);
            });

            return notificationsToShow;
        }

        async function loadNotifications() {
            const records = await fetchNotifications();
            const notifications = filterNotifications(records);

            notificationList.innerHTML = ''; // Clear existing notifications

            if (notifications.length === 0) {
                notificationList.innerHTML = '<li>No new notifications</li>';
                notificationDot.style.display = 'none'; // Hide the dot if no notifications
            } else {
                notificationDot.style.display = 'block'; // Show the dot if there are notifications
                notifications.forEach(notification => {
                    const li = document.createElement('li');
                    li.textContent = Subject: "${notification.fields.subject}" - Message: "${notification.fields.message}";
                    notificationList.appendChild(li);
                });
            }
        }

        // Polling every 10 seconds to fetch new notifications
        setInterval(loadNotifications, 100); // Fetch notifications every 10 seconds
    </script>
</body>
</html>
